线程池的实现
JOOQ

MQTT可以保持设备与服务器之间的长连接，避免反复的轮询，减少资源消耗，所以更加省电
MQTT可以在设备和服务器之间建立双向连接，从而可以使用推送

在EC2上安装一个Mosquitto代理。设备端把原先HTTP里的消息头和消息体合并到一个MQTT消息里，并发送到Mosquitto代理的一个主题上。后端的API端点对这个主题进行订阅，然后处理接收到的消息。API服务对消息进行处理后，把相应的响应消息发回Mosquitto代理，再推送给设备端。

在有多个API服务器的情况下，存在重复处理消息的问题。因为多个API服务器同时订阅相同的主题，它们会收到一个消息的多个拷贝。

在系统里引入了AWS的IoT。AWS IoT在它的内部使用了MQTT代理，同时包含了一个强大的规则引擎，可以利用这个引擎对Mosquitto的消息进行处理，比如把它们保存起来，发送通知或者使用lambda函数处理消息的响应。不过这里需要先把Mosquitto和AWS IoT桥接起来，这样消息就可以进入到AWS IoT。然后使用lambda函数对消息进行处理，抽取消息里的消息头和消息体，最后调用后端的HTTP API服务。

        QoS - MQTT提供了三层QoS。这个是非常重要的，因为在底层网络不是很稳定的时候，MQTT仍然能通过重试等手段保证消息可以被正确送达。

        消息保留 - MQTT可以为每个主题保留最后一个消息。这对客户端来说，可以反应主题的状态。

        处理MQTT消息 - 设置一个Mosquitto代理并让消息流入这个代理是很容易的，但因为缺少第三方包，要让一般的规则引擎来出来这些消息有点棘手。所以最后选用了AWS IoT自带的规则引擎。

        日志 - 需要对Mosquitto的日志进行捕捉，并保存起来，方便监控和问题定位。可以使用remote syslog来把日志传输到Papertrail。

除了服务器端，在客户端也需要使用MQTT的客户端包。MQTT有各种语言客户端，并支持Android、iOS平台。
